<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<link rel="icon" type="image/png" href="/compass-white.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>MML2 StateViewer</title>

		<link rel='stylesheet' type='text/css' href='/layout.css'/>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

		<script src="https://kit.fontawesome.com/da43231f0c.js" crossorigin="anonymous"></script>

		<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

	</head>
	<body class='p-0'>
		
		<script type="module" src="/src/Frambuffer.ts"></script>

		<!-- Start State Select -->

		<section class='state-select'>
			<nav class="navbar bg-primary" data-bs-theme="dark">
				<div class="container-fluid">
    				<a class="navbar-brand">
						<img src="/compass-white.png" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">
      					MML2 StateViewer
    				</a>
					<button id='toggle-btn' class="btn btn-outline-light btn-sm" type="button">
						<span class="navbar-toggler-icon"></span>
    				</button>
				</div>
			</nav>
		</section>

		<section id='state-list' class='state-list hide'>
			<div class='header'>
				<div class="form-check form-switch">
					<input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
					<label class="form-check-label" for="flexSwitchCheckDefault">Placeholders</label>
				</div>

			</div>
			<ul id='state-select' class="list-group list-group-flush">
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
				<li class='list-group-item'>Stage 0x00 Area 0x00</li>
			</ul>
		</section>

		<section id='asset-list' class='state-list'>
			<div class='w-100 p-1 border-bottom'>
				<nav class="nav nav-pills nav-fill justify-content-between">
					<a class="nav-link active" href='#' aria-current="page">Entity</a>
					<a class="nav-link disabled">Player</a>
					<a class="nav-link disabled">Map</a>
				</nav>
			</div>
			<div class='initial-state'>
				
				<h3 class='p-2'>Get Started</h3>

				<p class='p-2'>
					Looks like you dont have any save states.
					Drag and drop save state files from
					PCSXR or Dusk Station to start exploring them.
				</p>
				
				<input type='file' id='file-select'/>
			</div>

			<ul class="list-group list-group-flush" id='asset-select'>
			</ul>
		</section>

		<script type="module" src="/src/StateSelect.ts"></script>
		<script type="module" src="/src/AssetSelect.ts"></script>

		<!-- End State Select -->

		<!--  Start Main -->

		<div class='top-nav'>
			<li id='download'>
				<i class="fa-sharp fa-solid fa-download"></i>
			</li>
			<a href='https://www.patreon.com/dashkion' target='_blank'>
				<li>
					<i class="fa-brands fa-patreon"></i>
				</li>
			</a>
			<a href='https://github.com/DashGL/Tool-MML2SaveStateViewer' target='_blank'>
				<li>
					<i class="fa-brands fa-github"></i>
				</li>
			</a>
		</div>
		
		<div class='right-nav'>
			
			<li id='tool-screenshot' data-text='Take Screenshot'>
				<i class="fa-duotone fa-camera"></i>	
			</li>
			<li id='tool-skeleton' data-text='Show/Hide Skeleton'>
				<i class="fa-duotone fa-skeleton"></i>
			</li>
			<li id='tool-grid' data-text='Show/Hide Grid'>
				<i class="fa-duotone fa-grid"></i>
			</li>
			<li id='tool-reset' data-text='Reset Camera'>
				<i class="fa-solid fa-camera-movie"></i>
			</li>

		</div>

		<canvas id='canvas'></canvas>
		<script type="module" src="/src/main.ts"></script>

		<!-- End Main -->

		<!-- Scripts -->
		<script type="importmap">
		{
    		"imports": {
      		"three": "https://unpkg.com/three@<version>/build/three.module.js"
    		}
		}
	</script>

	<script type="module">

		import { GLTFExporter } from 'three/addons/exporters/GLTFExporter.js';
		
		document.getElementById('download').addEventListener('click', () => {
			const exporter = new GLTFExporter();

			// Parse the input and generate the glTF output
			exporter.parse(
				window.mesh,
				function ( gltf ) {
					console.log( gltf );
					downloadObjectAsJson(gltf, 'mesh')
				},
				// called when there is an error in the generation
				function ( error ) {
					console.log( 'An error happened' );
				}
			);
		})

		function downloadObjectAsJson(exportObj, exportName){
			const str = JSON.stringify(exportObj, null, 2)
			const uri = encodeURIComponent(str);
    		const dataStr = `data:text/json;charset=utf-8,${uri}`
    		const a = document.createElement('a');
			a.setAttribute("href",     dataStr);
			a.setAttribute("download", `${exportName}.json`);
			document.body.appendChild(a);
			a.click();
			a.remove();
		}

	</script>	

	</body>
</html>
